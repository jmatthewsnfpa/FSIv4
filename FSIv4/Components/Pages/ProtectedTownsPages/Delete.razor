@page "/protectedtowns/delete"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@using FSIv4.Data.Models
@inject IDbContextFactory<FSIv4.Data.ApplicationDbContext> DbFactory
@inject NavigationManager NavigationManager
@rendermode InteractiveServer
@attribute [Authorize(Roles = "Admin, Owner")]

<PageTitle>Delete</PageTitle>

<h1>Delete Town</h1>

<br />

<p><a class="btn btn-dark" href="/protectedtowns">Back to List</a></p>

<div>

    <hr />
    @if (protectedtowns is null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        <dl class="row">
            <dt class="col-sm-2">Protected Town ID</dt>
            <dd class="col-sm-10">@protectedtowns.TownProtectedId</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">Protected Town Name</dt>
            <dd class="col-sm-10">@protectedtowns.TownProtectedName</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">NFPA FDID</dt>
            <dd class="col-sm-10">@protectedtowns.NfpaFdid</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">Department Name</dt>
            <dd class="col-sm-10">@protectedtowns.FdName</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">City</dt>
            <dd class="col-sm-10">@protectedtowns.City</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">State</dt>
            <dd class="col-sm-10">@protectedtowns.State</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">State ID</dt>
            <dd class="col-sm-10">@protectedtowns.StateId</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">State Group</dt>
            <dd class="col-sm-10">@protectedtowns.StateGroup</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">State Group Override</dt>
            <dd class="col-sm-10">@protectedtowns.StateGroupOverride</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">Created Date</dt>
            <dd class="col-sm-10">@protectedtowns.CreatedDt</dd>
        </dl>
        <dl class="row">
            <dt class="col-sm-2">Updated Date</dt>
            <dd class="col-sm-10">@protectedtowns.UpdatedDt</dd>
        </dl>

        <br />

        <div class="deleteWarning">
            <p style="margin-top: 1rem"><b>Are you sure you want to delete this town?</b></p>
            <p><u>This action cannot be undone!</u></p>
        </div>

        <br />

        <EditForm class="d-flex justify-content-center align-items-center" method="post" Model="protectedtowns" OnValidSubmit="DeleteProtectedTowns" FormName="delete" Enhance>
            <button type="submit" class="btn btn-danger" disabled="@(protectedtowns is null)">Delete</button>
            <a class="btn btn-dark mx-3" href="/protectedtowns">Back to List</a>
        </EditForm>
    }
</div>

<br />
<br />

@code {
    private ProtectedTowns? protectedtowns;

    [SupplyParameterFromQuery]
    private int TownProtectedId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        protectedtowns = await context.ProtectedTowns.FirstOrDefaultAsync(m => m.TownProtectedId == TownProtectedId);

        if (protectedtowns is null)
        {
            NavigationManager.NavigateTo("notfound");
        }
    }

    private async Task DeleteProtectedTowns()
    {
        using var context = DbFactory.CreateDbContext();
        context.ProtectedTowns.Remove(protectedtowns!);
        await context.SaveChangesAsync();
        NavigationManager.NavigateTo("/protectedtowns");
    }
}
